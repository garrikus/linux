// SPDX-License-Identifier: GPL-2.0-only
/*
 * Copyright (C) 2011 Texas Instruments Incorporated - http://www.ti.com/
 */
/dts-v1/;

#include "omap36xx.dtsi"
#include <dt-bindings/input/input.h>
/* #include "omap3-evm-common.dtsi" */
/* #include "omap3-evm-processor-common.dtsi" */

/ {
	model = "Navis Orion (2016 m.y.)";
	compatible = "navis,omap3-orion2016", "ti,omap3630", "ti,omap3";

	cpus {
		cpu@0 {
			cpu0-supply = <&vcc>;
		};
	};

	memory@80000000 {
		device_type = "memory";
		reg = <0x80000000 0x10000000>; /* 256 MB */
	};

	chosen {
		stdout-path = &uart3;
	};

	backlight_kbd: backlight_kbd {
		compatible = "pwm-backlight";
		pwms = <&pwm8 0 100000 0>; /* Omit flags (3rd pwm cell) */
		brightness-levels = <0 11 20 30 40 50 60 70 80 90 100>;
		default-brightness-level = <5>;	/* => 50 */
	};

	backlight_lcd: backlight_lcd {
		compatible = "pwm-backlight";
		pwms = <&pwm9 0 100000 0>; /* Omit flags (3rd pwm cell) */
		brightness-levels = <0 11 20 30 40 50 60 70 80 90 100>;
		default-brightness-level = <5>;	/* => 50 */
	};

	pwm8: dmtimer-pwm8 {
		compatible = "ti,omap-dmtimer-pwm";
		ti,timers = <&timer8>;
		#pwm-cells = <3>;
	};

	pwm9: dmtimer-pwm9 {
		compatible = "ti,omap-dmtimer-pwm";
		ti,timers = <&timer9>;
		#pwm-cells = <3>;
	};
};

&omap3_pmx_core {
	pinctrl-use-default; /* X-Loader has muxed the pins. Let them be. */
};

&gpio2 {
	rs232_forced_on {
		gpio-hog;
		gpios = <(38-32) GPIO_ACTIVE_HIGH>;	/* gpio_38 (address in gpio2) */
		output-high;
	};

	rs232_forced_off {
		gpio-hog;
		gpios = <(39-32) GPIO_ACTIVE_HIGH>;	/* gpio_39 (address in gpio2) */
		output-high;
	};
};

&gpio6 {
	lcd_panel_mode {
		gpio-hog;
		gpios = <18 GPIO_ACTIVE_HIGH>;
		output-high;
	};
};

&i2c1 {
	clock-frequency = <2600000>;

	twl: twl@48 {
		reg = <0x48>;
		interrupts = <7>; /* SYS_NIRQ cascaded to intc */
		interrupt-parent = <&intc>;
	};
};

&i2c2 {
	status = "okay";

	tca8418: keypad@34 {
		compatible = "ti,tca8418";
		reg = <0x34>;
		interrupt-parent = <&gpio1>;
		interrupts = <15 IRQ_TYPE_EDGE_FALLING>;
		linux,keymap = < MATRIX_KEY(0x00, 0x00, KEY_DOWN)
			MATRIX_KEY(0x00, 0x01, KEY_E)
			MATRIX_KEY(0x01, 0x00, KEY_LEFT)
			MATRIX_KEY(0x01, 0x01, KEY_J)
			MATRIX_KEY(0x01, 0x02, KEY_B)
			MATRIX_KEY(0x02, 0x00, KEY_RIGHT)
			MATRIX_KEY(0x02, 0x01, KEY_A)
			MATRIX_KEY(0x03, 0x00, KEY_UP)
			MATRIX_KEY(0x03, 0x01, KEY_ENTER)
			MATRIX_KEY(0x03, 0x02, KEY_I)
		>;
		keypad,num-rows = <8>;
		keypad,num-columns = <10>;
	};
};

#include "twl4030.dtsi"
/* #include "twl4030_omap3.dtsi" */

&vaux3 {
	regulator-min-microvolt = <2800000>;
	regulator-max-microvolt = <2800000>;
};

&dss {
	status = "ok";
};

&dsi {
	status = "ok";

	/*
	pinctrl-names = "default";
	pinctrl-0 = <&dsi_pins>;

	vdd-supply = <&vpll2>;
	 */

	port {
		dsi_out_ep: endpoint {
			remote-endpoint = <&lcd0_in>;
			lanes = <2 3 0 1 4 5>;
		};
	};

	lcd0: display {
		compatible = "aviv-dsi";
		label = "lcd0";

		/*
		pinctrl-names = "default";
		pinctrl-0 = <&display_pins>;
		*/

		vpnl-supply = <&vaux3>;
		/*
		vddi-supply = <&vio>;
		 */

		reset-gpios = <&gpio6 20 GPIO_ACTIVE_HIGH>;
		/*te-gpios = <&gpio2 30 GPIO_ACTIVE_HIGH>;	 62 */

		width-mm = <52>; /* 51.84 mm */
		height-mm = <86>; /* 86.4 mm */

		/* TODO:
		 * - panel is upside-down
		 * - top + bottom 5px are not visible
		 */
		panel-timing {
			clock-frequency = <0>;          /* Calculated by dsi */

			hback-porch = <20>;
			hactive = <480>;
			hfront-porch = <20>;
			hsync-len = <5>;

			vback-porch = <16>;
			vactive = <800>;
			vfront-porch = <1>;
			vsync-len = <1>;

			hsync-active = <0>;
			vsync-active = <0>;
			de-active = <1>;
			pixelclk-active = <1>;
		};

		port {
			lcd0_in: endpoint {
				remote-endpoint = <&dsi_out_ep>;
			};
		};
	};
};
